<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カメラズーム</title>
</head>
<body>
    <video id="preview" autoplay></video>
    <input type="range" id="zoomSlider" min="1" max="3" step="0.1" value="1">
    <script>
        let currentStream;
        let mediaRecorder;
        let recordedChunks = [];

        // カメラを開始する関数
        function startCamera(facingMode = "environment") {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
            }

            navigator.mediaDevices.getUserMedia({
                video: { facingMode: { exact: facingMode } },
                audio: true
            })
            .then(stream => {
                currentStream = stream;
                const videoTrack = stream.getVideoTracks()[0];

                // スライダーイベントでズームを変更
                const zoomSlider = document.getElementById('zoomSlider');
                zoomSlider.addEventListener('input', () => {
                    const zoomLevel = parseFloat(zoomSlider.value);
                    videoTrack.applyConstraints({
                        advanced: [{ zoom: zoomLevel }]
                    }).catch(e => console.error('ズームの変更に失敗しました:', e));
                });

                preview.srcObject = stream;
                preview.play();

                mediaRecorder = new MediaRecorder(stream);
                mediaRecorder.ondataavailable = event => {
                    if (event.data.size > 0) {
                        recordedChunks.push(event.data);
                    }
                };

                mediaRecorder.onstop = async () => {
                    const recordedBlob = new Blob(recordedChunks, { type: 'video/webm' });
                    await downloadRecording(recordedBlob);
                    recordedChunks = [];
                };
            })
            .catch(error => {
                console.error('カメラの使用に失敗しました:', error);
            });
        }

        // カメラを開始
        startCamera();
    </script>
</body>
</html>
